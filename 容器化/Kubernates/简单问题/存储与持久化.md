# 1. 简述 Kubernetes 共享存储的作用？

**思路**：

强调“跨 Pod 持久化”和“多 Pod 共享访问”两大核心价值，区分临时存储与共享存储。

**回答**：

Kubernetes 共享存储主要用于：

- **实现数据持久化**：避免容器重启或重建导致数据丢失；
- **支持多 Pod 同时读写同一份数据**（如 Web 前端集群共享静态资源、数据库主从共享配置）；
- 解耦应用与底层存储细节，通过抽象（如 PVC）屏蔽云厂商或本地存储差异。
  典型场景包括日志聚合、内容管理系统、有状态服务（如 Jenkins、GitLab）等。

------

# 2. 简述 Kubernetes 数据持久化的方式有哪些？

**思路**：

分三类：emptyDir（临时）、hostPath（单节点）、网络存储（持久化），重点突出网络存储为生产首选。

**回答**：

Kubernetes 提供多种数据持久化方式：

- **emptyDir**：Pod 内容器共享的临时目录，生命周期同 Pod，节点重启即丢失，适用于缓存或临时交换；
- **hostPath**：挂载节点本地路径到 Pod，仅适用于单节点或 DaemonSet，不具备可移植性；
- **网络存储（推荐生产使用）**：
  - 直接使用云盘（如阿里云 ESSD、腾讯云 CBS）；
  - 通过 **PV/PVC 抽象**对接 NFS、Ceph、GlusterFS、iSCSI 等；
  - 基于 **CSI（Container Storage Interface）** 插件动态供应云存储。

> 生产环境应优先使用 PV/PVC + CSI 实现高可用、可迁移的持久化存储。

------

# 3. 简述 Kubernetes PV 和 PVC？

**思路**：

类比“资源供给 vs 资源申请”，说明解耦设计思想。

**回答**：

- **PV（PersistentVolume）**：由集群管理员或自动供应器创建的**集群级存储资源对象**，代表一块真实存储（如云盘、NFS 目录），包含容量、访问模式（ReadWriteOnce/ReadOnlyMany/ReadWriteMany）、回收策略等属性；
- **PVC（PersistentVolumeClaim）**：由用户创建的**存储请求**，声明所需容量、访问模式等；
- **绑定机制**：PVC 与满足条件的 PV 自动绑定（一对一），Pod 通过挂载 PVC 使用存储，**实现应用与底层存储解耦**。
  这种“供给-消费”模型使开发无需关心存储细节，运维可统一管理资源。

------

# 4. 简述 Kubernetes PV 生命周期内的阶段？

**思路**：

按时间线列出四个标准阶段（Available → Bound → Released → Retained/Deleted）。

**回答**：

PV 在生命周期中会经历以下阶段（`.status.phase`）：

1. **Available**：PV 已创建，尚未被 PVC 绑定；
2. **Bound**：已与某个 PVC 成功绑定，正在被使用；
3. **Released**：PVC 被删除，但 PV 尚未被回收（数据仍保留）；
4. **Retained / Deleted / Failed**：
   - 若 `persistentVolumeReclaimPolicy=Retain`，则停留在 Released，需手动清理；
   - 若为 `Delete`，则自动删除底层存储（如云盘）并进入 **Deleted** 状态；
   - **Failed** 表示回收过程出错。

> 注意：`Recycled` 策略已在 v1.15+ 废弃。

------

# 5. 简述 Kubernetes 所支持的存储供应模式？

**思路**：

区分“静态供应”和“动态供应”，强调动态供应是现代集群主流。

**回答**：

Kubernetes 支持两种存储供应模式：

- **静态供应（Static Provisioning）**：
  - 管理员**预先手动创建 PV**；
  - 用户创建 PVC 后，系统自动匹配合适 PV；
  - 适用于固定存储池或不支持自动化场景。
- **动态供应（Dynamic Provisioning）**：
  - 用户只需创建 PVC；
  - 系统根据 PVC 中指定的 **StorageClass** 自动调用后端存储插件（如 CSI）**按需创建 PV 和底层存储**；
  - 是云环境（ACK/TKE）的标准做法，提升效率与弹性。

> 动态供应依赖 StorageClass，且要求存储系统支持（如云盘、Ceph RBD）。

------

# 6. 简述 Kubernetes CSI 模型？

**思路**：

定位为“标准化存储插件接口”，说明其组件（Controller + Node）与优势。

**回答**：

**CSI（Container Storage Interface）** 是 Kubernetes 官方定义的**标准化存储插件接口**，用于将任意存储系统安全、可移植地集成到 K8s 中。其核心特点包括：

- **解耦设计**：存储厂商只需实现 CSI 插件，无需修改 K8s 核心代码；
- **两个核心组件**：
  - **Controller Plugin**：运行在控制平面，负责**创建/删除卷**（如调用云 API 创建云盘）；
  - **Node Plugin**：以 DaemonSet 运行在每个节点，负责**挂载/卸载卷到 Pod**（如执行 `mount`）；
- **支持动态供应、快照、克隆、扩容等高级功能**；
- 云厂商（如阿里云、腾讯云）均提供官方 CSI Driver，替代早期 in-tree 插件。
  CSI 是现代 K8s 存储扩展的事实标准。