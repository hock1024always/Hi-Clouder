# 1. 简述 Kubernetes 如何保证集群的安全性？

**思路**：

从“四层防线”切入：认证 → 授权 → 准入控制 → 运行时安全，体现纵深防御思想。

**回答**：

Kubernetes 通过多层机制保障集群安全：

1. **认证（Authentication）**：通过 TLS 证书、ServiceAccount Token、OIDC 等验证用户/组件身份；
2. **授权（Authorization）**：基于 RBAC、ABAC 或 Webhook，控制谁可以对哪些资源执行什么操作；
3. **准入控制（Admission Control）**：在请求持久化前拦截修改或拒绝（如 ResourceQuota、PodSecurityPolicy）；
4. **运行时安全**：
   - 使用 **Secret** 管理敏感信息（避免明文写 YAML）；
   - 通过 **NetworkPolicy** 限制 Pod 间通信；
   - 启用 **Pod 安全策略（PSP）或新 PSP 替代方案（如 Pod Security Admission）** 限制特权容器、root 用户等高危行为；
5. **审计日志（Audit Log）**：记录所有 API 请求，用于追踪与合规。
   云厂商托管服务（如 ACK/TKE）还提供网络隔离、镜像扫描、安全加固等增强能力。

------

# 2. 简述 Kubernetes 准入机制？

**思路**：

区分 Mutating（修改）和 Validating（校验）两类准入控制器，说明其工作时机（API Server 持久化前）。

**回答**：

Kubernetes 准入机制（Admission Control）是在 API 请求**通过认证/授权后、写入 etcd 前**执行的拦截机制，分为两类：

- **Mutating Admission Controllers**：可**修改**请求对象（如自动注入 sidecar、设置默认资源 limits）；
- **Validating Admission Controllers**：仅**校验**请求是否合法（如拒绝未指定资源 requests 的 Pod）；
  常见内置控制器包括：`ResourceQuota`、`LimitRanger`、`PodSecurityPolicy`（已弃用）、`NamespaceLifecycle` 等。
  此外，可通过 **Dynamic Admission Webhooks**（如 OPA/Gatekeeper、Kyverno）实现自定义策略，是实现 GitOps 安全合规的关键手段。

------

# 3. 简述 Kubernetes RBAC 及其特点（优势）？

**思路**：

定义 RBAC 模型（Role/ClusterRole + Binding），强调细粒度、可组合、命名空间隔离。

**回答**：

RBAC（Role-Based Access Control）是 Kubernetes 默认的授权机制，核心由四类对象组成：

- **Role / ClusterRole**：定义一组权限（如 `get pods`, `list services`）；
- **RoleBinding / ClusterRoleBinding**：将角色绑定到用户、组或 ServiceAccount。
  **特点与优势**：
- **细粒度控制**：可精确到资源类型、动词（get/list/create/delete）、命名空间；
- **命名空间隔离**：Role 和 RoleBinding 作用于单个 namespace，ClusterRole 全局有效；
- **可复用性**：一个 ClusterRole 可被多个 Binding 引用；
- **最小权限原则**：支持为 CI/CD 工具、监控系统等分配最小必要权限，提升安全性。

> 生产环境必须启用 RBAC 并严格管理权限。

------

# 4. 简述 Kubernetes Secret 作用？

**思路**：

强调“敏感信息解耦”和“加密存储（base64 非加密，需 etcd 加密或外部方案）”。

**回答**：

Secret 用于**安全地存储和分发敏感信息**（如密码、Token、TLS 证书、SSH 密钥），避免将其硬编码在 Pod YAML 或镜像中。其作用包括：

- 将敏感数据与应用配置分离；
- 以 Volume 或环境变量形式挂载到 Pod 中；
- 支持多种类型（`Opaque`、`kubernetes.io/tls`、`docker-registry` 等）；

> 注意：Secret 默认仅 base64 编码（非加密），需配合 **etcd 静态加密（Encryption at Rest）** 或使用外部方案（如 HashiCorp Vault、云厂商 KMS）提升安全性。

------

# 5. 简述 Kubernetes Secret 有哪些使用方式？

**思路**：

列举两种主流方式：Volume 挂载（推荐） vs 环境变量（谨慎使用）。

**回答**：

Secret 主要通过以下方式供 Pod 使用：

1. **作为 Volume 挂载**（推荐）：
   - Secret 以文件形式挂载到容器指定目录（如 `/etc/secrets/password`）；
   - 应用读取文件获取敏感信息；
   - 支持自动更新（若 Secret 更新，挂载内容最终一致）；
2. **作为环境变量注入**（不推荐用于高敏场景）：
   - 在容器 spec 中通过 `valueFrom.secretKeyRef` 引用；
   - 风险：环境变量可能被 `ps`、日志泄露，且更新 Secret 后不会自动刷新；

> 最佳实践：优先使用 Volume 挂载，并限制 Pod 对 Secret 的访问权限（RBAC）。

------

# 6. 简述 Kubernetes PodSecurityPolicy 机制？

**思路**：

说明其定位（准入控制器）、作用（限制 Pod 特权行为），并指出已弃用、被 PSA 替代。

**回答**：

PodSecurityPolicy（PSP）是一种**准入控制器机制**，用于在 Pod 创建前强制实施安全策略，限制高风险配置，例如：禁止以 root 用户运行、禁止特权容器、限制 hostPath 挂载等。
 管理员创建 PSP 对象，用户需通过 RBAC 被授权使用某个 PSP，Pod 才能被创建。

> **重要更新**：PSP 自 Kubernetes v1.21 起**已被弃用**，并在 v1.25+ **彻底移除**，官方推荐使用新的 **Pod Security Admission（PSA）** 或第三方策略引擎（如 OPA/Gatekeeper、Kyverno）替代。

------

# 7. 简述 Kubernetes PodSecurityPolicy 机制能实现哪些安全策略？

**思路**：

列举典型策略项，体现对容器运行时安全的理解。

**回答**：

尽管 PSP 已弃用，但其支持的安全策略具有代表性，包括：

- **禁止特权容器**（`privileged: false`）；
- **限制 root 用户运行**（`runAsNonRoot: true`）；
- **禁止访问宿主机命名空间**（如 `hostPID`, `hostIPC`, `hostNetwork` 设为 false）；
- **限制挂载敏感 hostPath**（如 `/etc`, `/proc`）；
- **强制只读根文件系统**（`readOnlyRootFilesystem: true`）；
- **限制 Linux Capabilities**（如 drop `NET_ADMIN`, `SYS_ADMIN`）；
- **设置 SELinux/AppArmor 配置**。
  这些策略有效降低容器逃逸和提权风险，是构建安全基线的重要手段。当前应通过 **Pod Security Admission（PSA）的 baseline/restricted 模式**或 **OPA/Gatekeeper** 实现类似能力。



