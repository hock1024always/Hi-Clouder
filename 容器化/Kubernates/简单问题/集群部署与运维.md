# 简述 Kubernetes Worker 节点加入集群的过程？

**思路**：

从 kubelet 启动到注册成功，强调证书、API Server 通信、Node 对象创建等关键步骤。

**回答**：

Worker 节点加入集群的核心流程如下：

1. 在节点上安装 kubelet、kube-proxy 和容器运行时（如 containerd）；
2. 配置 kubelet 指向控制平面的 API Server 地址，并提供**合法的 TLS 证书或 bootstrap token**（用于首次认证）；
3. kubelet 启动后，向 API Server 发起注册请求；
4. 若使用 **Bootstrap Token**，API Server 会通过 `Node Bootstrap` 机制自动签发客户端证书（由 CSR 控制器处理）；
5. 注册成功后，API Server 创建对应的 **Node 对象**，并标记为 `Ready`（待 kubelet 上报状态）；
6. kube-scheduler 开始向该节点调度 Pod，kube-proxy 启动网络代理。

> 生产中通常通过 kubeadm join 或云厂商自动化工具完成此过程。

------

# 简述 Kubernetes 如何进行优雅的节点关机维护？

**思路**：

强调“驱逐 Pod + 标记不可调度”两步走，避免服务中断。

**回答**：

Kubernetes 通过以下步骤实现节点优雅维护：

1. 执行 `kubectl cordon <node>`：将节点标记为 **不可调度（SchedulingDisabled）**，新 Pod 不会调度到该节点；
2. 执行 `kubectl drain <node>`：
   - 自动驱逐（evict）该节点上所有可迁移的 Pod（由对应控制器重建）；
   - 跳过 DaemonSet 管理的 Pod（因其绑定节点，通常无需迁移）；
   - 可加 `--ignore-daemonsets --delete-emptydir-data` 等参数控制行为；
3. 待 Pod 迁移完成后，安全关机或维护节点；
4. 维护结束后，执行 `kubectl uncordon <node>` 恢复调度。
   该流程保障业务无损，是标准运维操作。

------

# 简述 Kubernetes 集群联邦？

**思路**：

说明其目标（跨集群管理）、演进（从 Federation v1 到 KubeFed）、现状（社区转向 Cluster API / Service Mesh 方案）。

**回答**：

Kubernetes 集群联邦（Federation）旨在**统一管理多个独立的 K8s 集群**，实现跨集群的服务发现、负载分发和高可用。早期 Federation v1 因复杂性被弃用，后续推出 **KubeFed（Federation v2）**，支持：

- 跨集群同步资源（如 Deployment、Service）；
- 基于地理位置或策略的流量分发；
- 多集群统一策略管理。
  但目前社区更倾向于使用 **Cluster API（CAPI）管理集群生命周期** + **Service Mesh（如 Istio）实现跨集群通信**，KubeFed 应用较少，云厂商多提供自有跨集群方案（如阿里云 ACK One）。

------

# 简述 Kubernetes 常见的部署方式？

**思路**：

按场景分类：本地开发、自建生产、托管服务、自动化工具。

**回答**：

Kubernetes 常见部署方式包括：

- **本地开发**：Minikube、Kind（Kubernetes in Docker）、k3s（轻量级）；
- **自建生产集群**：
  - `kubeadm`：官方推荐，用于快速初始化 HA 集群；
  - `kops`：面向 AWS/GCE 的自动化部署工具；
  - 二进制部署：手动下载组件、配置证书，灵活性高但复杂；
- **云厂商托管服务**：
  - 阿里云 ACK、腾讯云 TKE、AWS EKS、GCP GKE —— 免运维控制平面，集成 VPC、SLB、监控等；
- **GitOps 工具**：Argo CD / Flux 结合 Helm/Kustomize 实现声明式持续部署。
  生产环境强烈推荐使用托管服务或 kubeadm + 自动化脚本。

------

# 简述 Kubernetes 如何实现集群管理？

**思路**：

从“控制平面核心组件 + 声明式 API + 控制器模式”切入，体现其自愈与自动化本质。

**回答**：

Kubernetes 通过 **声明式 API + 控制器模式（Control Loop）** 实现集群自动化管理：

1. 用户提交期望状态（如 “Deployment 副本数=3”）到 **API Server**，持久化至 etcd；
2. 各类 **控制器（Controller）**（如 Deployment Controller、Node Controller）持续 watch API Server，对比“当前状态”与“期望状态”；
3. 若存在差异，控制器执行调谐（Reconcile）操作（如创建 Pod、驱逐故障节点）；
4. **kubelet** 在节点侧确保容器实际运行状态符合 PodSpec；
5. 整个系统形成闭环，具备**自愈、自适应、自管理**能力。
   这种“声明即意图”的设计是 Kubernetes 实现大规模集群可靠运维的核心范式。
